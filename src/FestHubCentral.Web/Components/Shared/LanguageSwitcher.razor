@using System.Globalization
@inject NavigationManager Navigation

<div class="language-switcher">
    <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        @GetFlagEmoji(currentCulture) @GetLanguageName(currentCulture)
    </button>
    <ul class="dropdown-menu dropdown-menu-end">
        <li>
            <button class="dropdown-item @(currentCulture == "en" ? "active" : "")" @onclick="@(() => ChangeLanguage("en"))">
                ðŸ‡¬ðŸ‡§ English
            </button>
        </li>
        <li>
            <button class="dropdown-item @(currentCulture == "de" ? "active" : "")" @onclick="@(() => ChangeLanguage("de"))">
                ðŸ‡©ðŸ‡ª Deutsch
            </button>
        </li>
    </ul>
</div>

<style>
    .language-switcher {
        display: inline-block;
    }

    .language-switcher .dropdown-item.active {
        background-color: var(--bs-primary);
        color: white;
    }
</style>

@code {
    private string currentCulture = "en";

    protected override void OnInitialized()
    {
        currentCulture = CultureInfo.CurrentCulture.Name;
    }

    private void ChangeLanguage(string culture)
    {
        if (currentCulture == culture) return;

        var uri = new Uri(Navigation.Uri).GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var cultureEscaped = Uri.EscapeDataString(culture);
        var uriEscaped = Uri.EscapeDataString(uri);

        Navigation.NavigateTo($"/Culture/Set?culture={cultureEscaped}&redirectUri={uriEscaped}", forceLoad: true);
    }

    private string GetFlagEmoji(string culture)
    {
        return culture switch
        {
            "en" => "ðŸ‡¬ðŸ‡§",
            "de" => "ðŸ‡©ðŸ‡ª",
            _ => "ðŸŒ"
        };
    }

    private string GetLanguageName(string culture)
    {
        return culture switch
        {
            "en" => "English",
            "de" => "Deutsch",
            _ => "Language"
        };
    }
}
